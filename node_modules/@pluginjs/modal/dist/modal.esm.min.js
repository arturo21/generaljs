/*!
 * @pluginjs/modal v0.7.20 (https://pluginjs.com)
 * Copyright 2019 Creation Studio Limited
 * Released under the GPL-3.0 License.
 */
import t from"@pluginjs/template";import{deepMerge as s}from"@pluginjs/utils";import{isFunction as e,isString as n,isElement as i,isObject as o}from"@pluginjs/is";import{addClass as a,removeClass as c}from"@pluginjs/classes";import{bindEvent as l,bindEventOnce as h}from"@pluginjs/events";import{parseHTML as r,query as p,append as u,data as d,remove as m}from"@pluginjs/dom";import{translateable as v,themeable as b,styleable as E,eventable as f,stateable as g,optionable as C,register as N}from"@pluginjs/decorator";import T from"@pluginjs/global-component";var O,$={OPEN:"open",CLOSE:"close",DESTROY:"destroy",READY:"ready"},y={NAMESPACE:"pj-".concat("modal"),ELEMENT:"{namespace}",THEME:"{namespace}--{theme}",CLOSE:"{namespace}-close",CONTENT:"{namespace}-content",TITLE:"{namespace}-title",DISABLED:"{namespace}-disabled",CONTAINER:"{namespace}-container",HEADER:"{namespace}-header",BUTTONS:"{namespace}-buttons",OVERLAY:"{namespace}-overlay",FADEIN:"{namespace}--fadeIn",OPEN:"{namespace}-open",IN:"{namespace}-in",BUTTON:"{namespace}-btn",ICON:"{namespace}-icon",ICONTITLE:"{namespace}-title-icon"},A={theme:null,template:()=>'<div class="{classes.NAMESPACE}">\n              {overlay}\n              <div class="{classes.CONTAINER}" role="document">\n                {close}\n                {title}\n                {content}\n                {buttons}\n              </div>\n            </div>',templates:{close:()=>'<button type="button" class="pj-icon pj-icon-close {classes.CLOSE}" aria-label="Close"></button>',title:()=>'<div class="{classes.TITLE}"></div>',icon:()=>'<i class="{classes.ICON} {iconClass}"></i>',content:()=>'<div class="{classes.CONTENT}"></div>',buttons:()=>'<div class="{classes.BUTTONS}"></div>',overlay:()=>'<div class="{classes.OVERLAY}"></div>',button:()=>'<button class="{classes.BUTTON} {custom}" data-action={action} type="button">{label}</button>'},title:"",content:"",html:!0,closeable:!0,locale:"en",localeFallbacks:!0,buttons:null,overlay:!0,overlayCloseOnClick:!0,appendTo:"body",effect:"fadeScale",defaultButtonClass:"pj-btn pj-btn-primary",icon:null,icons:{success:"pj-icon pj-icon-check-circle",info:"pj-icon pj-icon-info-circle",error:"pj-icon pj-icon-close-circle"}},I=v({en:{Cancel:"Cancel",Yes:"Yes"},zh:{Cancel:"取消",Yes:"确定"}})(O=b()(O=E(y)(O=f($)(O=g()(O=C(A,!1)(O=N("modal")(O=class v extends T{constructor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.setupOptions(t),this.setupClasses(),this.$element=r(this.createHtml()),this.$container=p(".".concat(this.classes.CONTAINER),this.$element),this.setupStates(),this.setupI18n(),this.initialize(),this.bind()}validate(){return this.options.buttons&&this.options.buttons.forEach(t=>{t.classes||(t.classes=this.options.defaultButtonClass),t.label||(t.label="Yes")}),!0}open(){return!this.is("opened")&&(a("".concat(this.classes.OPEN),p("body")),u(this.$element,p(this.options.appendTo)),this.options.overlay&&(a("".concat(this.classes.NAMESPACE,"-fadeIn"),this.$overlay),c("".concat(this.classes.NAMESPACE,"-fadeOut"),this.$overlay)),c("".concat(this.classes.NAMESPACE,"-").concat(this.options.effect,"Out"),this.$container),a("".concat(this.classes.NAMESPACE,"-").concat(this.options.effect,"In"),this.$container),this.trigger($.OPEN),this.enter("opened"),this.leave("hide"),!1)}bind(){this.options.closeable&&l(this.eventName("click"),()=>{this.close()},this.$closeBtn),this.options.buttons&&l(this.eventName("click"),t=>{if(!t.target.classList.contains(this.classes.BUTTON)||!d("action",t.target))return!1;for(var s=d("action",t.target),n=0;n<this.options.buttons.length;n++)if(s===this.options.buttons[n].action){var i=this.options.buttons[n];e(i.fn)?i.fn(this.close.bind(this)):this.close()}return!1},this.$buttons),this.options.overlayCloseOnClick&&this.options.overlay&&l(this.eventName("click"),()=>{this.close()},this.$overlay)}close(){if(!this.is("opened"))return!1;c("".concat(this.classes.OPEN),p("body")),this.options.overlay&&(a("".concat(this.classes.NAMESPACE,"-fadeOut"),this.$overlay),c("".concat(this.classes.NAMESPACE,"-fadeIn"),this.$overlay)),a("".concat(this.classes.NAMESPACE,"-").concat(this.options.effect,"Out"),this.$container),c("".concat(this.classes.NAMESPACE,"-").concat(this.options.effect,"In"),this.$container);return h(this.eventName("animationend"),()=>{this.removeOverflow(),this.destroy()},this.$element),this.trigger($.CLOSE),this.leave("opened"),!1}removeOverflow(){var t=!0,s=this.constructor.getInstances(),e=s.length;if(0===e)t=!0;else{var n=0;s.forEach(t=>{t.is("hide")&&n++}),n!==e&&(t=!1)}t&&c(this.classes.OPEN,window.document.body)}visible(){return!!this.is("opened")}initialize(){this.validate(),this.$content=p(".".concat(this.classes.CONTENT),this.$element),this.$title=p(".".concat(this.classes.TITLE),this.$element),this.$closeBtn=p(".".concat(this.classes.CLOSE),this.$element),this.$buttons=p(".".concat(this.classes.BUTTONS),this.$element),this.options.overlay&&(this.$overlay=p(".".concat(this.classes.OVERLAY),this.$element)),this.options.theme&&a(this.getThemeClass(),this.$container),""!==this.options.title&&this.setTitle(this.options.title),""!==this.options.content&&this.setContent(this.options.content),this.options.buttons&&this.setButtons(this.options.buttons),this.trigger($.READY),this.enter("initialized")}createHtml(){var s="",e="",n="",i="",o="",a="";return this.options.closeable&&(s=t.render(this.options.templates.close.call(this),{classes:this.classes})),this.options.overlay&&(n=t.render(this.options.templates.overlay.call(this),{classes:this.classes})),""!==this.options.title&&(i=t.render(this.options.templates.title.call(this),{classes:this.classes})),""!==this.options.content&&(o=t.render(this.options.templates.content.call(this),{classes:this.classes})),this.options.buttons&&(e=t.render(this.options.templates.buttons.call(this),{classes:this.classes})),this.options.icon&&(a=t.render(this.options.templates.icon.call(this),{classes:this.classes,iconClass:this.getIconClass()}),this.$icon=r(a)),t.render(this.options.template.call(this),{classes:this.classes,overlay:n,close:s,title:i,content:o,buttons:e})}getIconClass(){return this.options.icons[this.options.icon]?this.options.icons[this.options.icon]:n(this.options.icon)?this.options.icon:this.options.icons.success}setTitle(t){this.$title.innerHTML="",this.options.icon&&(u(this.$icon,this.$title),a(this.getClass(this.classes.ICONTITLE),this.$title)),u(t,this.$title)}setContent(t){i(t)?u(t,this.$content):this.options.html?this.$content.innerHTML=t:this.$content.textContent=t}setButtons(t){for(var s in this.$buttons.innerHTML="",t)if(t[s].action){var e=this.createBtn(t[s]);u(e,this.$buttons)}}createBtn(s){var e=s.classes,n=s.action,i="";i=["Yes","Cancel"].includes(s.label)?this.translate(s.label):s.label;var o=t.render(this.options.templates.button.call(this),{classes:this.classes,custom:e,label:i,action:n});return r(o)}destroy(){this.is("initialized")&&this.leave("initialized"),this.trigger($.DESTROY),m(this.$element),super.destroy()}static open(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=new v(t);return s.open(),s}static init(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=s(t),n=new v(e);return n.enter("hide"),n}static close(t){this.getInstances().forEach(s=>{s.instanceId===t&&s.close()})}static confirm(){for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];if(!n(i[0]))return!1;var c=s(A,{title:"",content:"",closeable:!0,buttons:[{action:"cancel",label:"Cancel",classes:"pj-btn pj-btn-outline",fn:""},{action:"yes",label:"Yes",classes:"pj-btn pj-btn-primary",fn:""}]}),l=[],h=[],r=i.length;r&&o(i[r-1])&&(i[r-1].buttons&&(i[r-1].buttons.forEach(t=>{c.buttons.forEach(s=>{t.action===s.action&&(s.label=t.label,s.classes=t.classes)})}),delete i[r-1].buttons),c=s(c,i[r-1]),r-=1);for(var p=0;p<r;p++)"string"==typeof i[p]?l.push(i[p]):e(i[p])&&h.push(i[p]);1===l.length?c.content=l[0]:l.length>1&&(c.title=l[0],c.content=l[1]),1===h.length?c.buttons.forEach(t=>{"yes"===t.action&&(t.fn=h[0])}):h.length>1&&c.buttons.forEach(t=>{"yes"===t.action&&(t.fn=h[0]),"cancel"===t.action&&(t.fn=h[1])});var u=new v(c);return u.open(),u}static alert(){if(!n(arguments.length<=0?void 0:arguments[0]))return!1;var t=s(A,{title:"",content:"",closeable:!0}),e=arguments.length;e&&o(e-1<0||arguments.length<=e-1?void 0:arguments[e-1])&&(t=s(t,e-1<0||arguments.length<=e-1?void 0:arguments[e-1]),e-=1),1===e?t.content=arguments.length<=0?void 0:arguments[0]:2===e&&(t.title=arguments.length<=0?void 0:arguments[0],t.content=arguments.length<=1?void 0:arguments[1]);var i=new v(t);return i.open(),i}static closeTop(){var t=this.getInstances(),s=t.length;return!!s&&(t[s-1].close(),!0)}static closeAll(){return this.getInstances().forEach(t=>{t.close()}),!0}static getAll(){return this.getInstances()}static getById(t){var s=this.getInstances(),e=null;return s.forEach(s=>{s.instanceId===t&&(e=s)}),e}})||O)||O)||O)||O)||O)||O)||O;export default I;
