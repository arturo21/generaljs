/*!
 * @pluginjs/modal v0.7.20 (https://pluginjs.com)
 * Copyright 2019 Creation Studio Limited
 * Released under the GPL-3.0 License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@pluginjs/template"),require("@pluginjs/utils"),require("@pluginjs/is"),require("@pluginjs/classes"),require("@pluginjs/events"),require("@pluginjs/dom"),require("@pluginjs/decorator"),require("@pluginjs/global-component")):"function"==typeof define&&define.amd?define(["@pluginjs/template","@pluginjs/utils","@pluginjs/is","@pluginjs/classes","@pluginjs/events","@pluginjs/dom","@pluginjs/decorator","@pluginjs/global-component"],e):(t=t||self)["@pluginjs/modal"]=e(t["@pluginjs/template"],t["@pluginjs/utils"],t["@pluginjs/is"],t["@pluginjs/classes"],t["@pluginjs/events"],t["@pluginjs/dom"],t["@pluginjs/decorator"],t["@pluginjs/global-component"])}(this,(function(t,e,s,n,i,o,a,l){"use strict";function c(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function p(t,e,s){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,s){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(s):i.value}})(t,e,s||t)}t=t&&t.hasOwnProperty("default")?t.default:t,l=l&&l.hasOwnProperty("default")?l.default:l;var f,d={OPEN:"open",CLOSE:"close",DESTROY:"destroy",READY:"ready"},v={NAMESPACE:"pj-".concat("modal"),ELEMENT:"{namespace}",THEME:"{namespace}--{theme}",CLOSE:"{namespace}-close",CONTENT:"{namespace}-content",TITLE:"{namespace}-title",DISABLED:"{namespace}-disabled",CONTAINER:"{namespace}-container",HEADER:"{namespace}-header",BUTTONS:"{namespace}-buttons",OVERLAY:"{namespace}-overlay",FADEIN:"{namespace}--fadeIn",OPEN:"{namespace}-open",IN:"{namespace}-in",BUTTON:"{namespace}-btn",ICON:"{namespace}-icon",ICONTITLE:"{namespace}-title-icon"},b={theme:null,template:function(){return'<div class="{classes.NAMESPACE}">\n              {overlay}\n              <div class="{classes.CONTAINER}" role="document">\n                {close}\n                {title}\n                {content}\n                {buttons}\n              </div>\n            </div>'},templates:{close:function(){return'<button type="button" class="pj-icon pj-icon-close {classes.CLOSE}" aria-label="Close"></button>'},title:function(){return'<div class="{classes.TITLE}"></div>'},icon:function(){return'<i class="{classes.ICON} {iconClass}"></i>'},content:function(){return'<div class="{classes.CONTENT}"></div>'},buttons:function(){return'<div class="{classes.BUTTONS}"></div>'},overlay:function(){return'<div class="{classes.OVERLAY}"></div>'},button:function(){return'<button class="{classes.BUTTON} {custom}" data-action={action} type="button">{label}</button>'}},title:"",content:"",html:!0,closeable:!0,locale:"en",localeFallbacks:!0,buttons:null,overlay:!0,overlayCloseOnClick:!0,appendTo:"body",effect:"fadeScale",defaultButtonClass:"pj-btn pj-btn-primary",icon:null,icons:{success:"pj-icon pj-icon-check-circle",info:"pj-icon pj-icon-info-circle",error:"pj-icon pj-icon-close-circle"}};return a.translateable({en:{Cancel:"Cancel",Yes:"Yes"},zh:{Cancel:"取消",Yes:"确定"}})(f=a.themeable()(f=a.styleable(v)(f=a.eventable(d)(f=a.stateable()(f=a.optionable(b,!1)(f=a.register("modal")(f=function(a){function l(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l),(t=h(this,r(l).call(this))).setupOptions(e),t.setupClasses(),t.$element=o.parseHTML(t.createHtml()),t.$container=o.query(".".concat(t.classes.CONTAINER),t.$element),t.setupStates(),t.setupI18n(),t.initialize(),t.bind(),t}var f,v,y;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(l,a),f=l,y=[{key:"open",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new l(t);return e.open(),e}},{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=e.deepMerge(t),n=new l(s);return n.enter("hide"),n}},{key:"close",value:function(t){this.getInstances().forEach((function(e){e.instanceId===t&&e.close()}))}},{key:"confirm",value:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(!s.isString(n[0]))return!1;var o=e.deepMerge(b,{title:"",content:"",closeable:!0,buttons:[{action:"cancel",label:"Cancel",classes:"pj-btn pj-btn-outline",fn:""},{action:"yes",label:"Yes",classes:"pj-btn pj-btn-primary",fn:""}]}),a=[],c=[],r=n.length;r&&s.isObject(n[r-1])&&(n[r-1].buttons&&(n[r-1].buttons.forEach((function(t){o.buttons.forEach((function(e){t.action===e.action&&(e.label=t.label,e.classes=t.classes)}))})),delete n[r-1].buttons),o=e.deepMerge(o,n[r-1]),r-=1);for(var u=0;u<r;u++)"string"==typeof n[u]?a.push(n[u]):s.isFunction(n[u])&&c.push(n[u]);1===a.length?o.content=a[0]:a.length>1&&(o.title=a[0],o.content=a[1]),1===c.length?o.buttons.forEach((function(t){"yes"===t.action&&(t.fn=c[0])})):c.length>1&&o.buttons.forEach((function(t){"yes"===t.action&&(t.fn=c[0]),"cancel"===t.action&&(t.fn=c[1])}));var h=new l(o);return h.open(),h}},{key:"alert",value:function(){if(!s.isString(arguments.length<=0?void 0:arguments[0]))return!1;var t=e.deepMerge(b,{title:"",content:"",closeable:!0}),n=arguments.length;n&&s.isObject(n-1<0||arguments.length<=n-1?void 0:arguments[n-1])&&(t=e.deepMerge(t,n-1<0||arguments.length<=n-1?void 0:arguments[n-1]),n-=1),1===n?t.content=arguments.length<=0?void 0:arguments[0]:2===n&&(t.title=arguments.length<=0?void 0:arguments[0],t.content=arguments.length<=1?void 0:arguments[1]);var i=new l(t);return i.open(),i}},{key:"closeTop",value:function(){var t=this.getInstances(),e=t.length;return!!e&&(t[e-1].close(),!0)}},{key:"closeAll",value:function(){return this.getInstances().forEach((function(t){t.close()})),!0}},{key:"getAll",value:function(){return this.getInstances()}},{key:"getById",value:function(t){var e=this.getInstances(),s=null;return e.forEach((function(e){e.instanceId===t&&(s=e)})),s}}],(v=[{key:"validate",value:function(){var t=this;return this.options.buttons&&this.options.buttons.forEach((function(e){e.classes||(e.classes=t.options.defaultButtonClass),e.label||(e.label="Yes")})),!0}},{key:"open",value:function(){return!this.is("opened")&&(n.addClass("".concat(this.classes.OPEN),o.query("body")),o.append(this.$element,o.query(this.options.appendTo)),this.options.overlay&&(n.addClass("".concat(this.classes.NAMESPACE,"-fadeIn"),this.$overlay),n.removeClass("".concat(this.classes.NAMESPACE,"-fadeOut"),this.$overlay)),n.removeClass("".concat(this.classes.NAMESPACE,"-").concat(this.options.effect,"Out"),this.$container),n.addClass("".concat(this.classes.NAMESPACE,"-").concat(this.options.effect,"In"),this.$container),this.trigger(d.OPEN),this.enter("opened"),this.leave("hide"),!1)}},{key:"bind",value:function(){var t=this;this.options.closeable&&i.bindEvent(this.eventName("click"),(function(){t.close()}),this.$closeBtn),this.options.buttons&&i.bindEvent(this.eventName("click"),(function(e){if(!e.target.classList.contains(t.classes.BUTTON)||!o.data("action",e.target))return!1;for(var n=o.data("action",e.target),i=0;i<t.options.buttons.length;i++)if(n===t.options.buttons[i].action){var a=t.options.buttons[i];s.isFunction(a.fn)?a.fn(t.close.bind(t)):t.close()}return!1}),this.$buttons),this.options.overlayCloseOnClick&&this.options.overlay&&i.bindEvent(this.eventName("click"),(function(){t.close()}),this.$overlay)}},{key:"close",value:function(){var t=this;return!!this.is("opened")&&(n.removeClass("".concat(this.classes.OPEN),o.query("body")),this.options.overlay&&(n.addClass("".concat(this.classes.NAMESPACE,"-fadeOut"),this.$overlay),n.removeClass("".concat(this.classes.NAMESPACE,"-fadeIn"),this.$overlay)),n.addClass("".concat(this.classes.NAMESPACE,"-").concat(this.options.effect,"Out"),this.$container),n.removeClass("".concat(this.classes.NAMESPACE,"-").concat(this.options.effect,"In"),this.$container),i.bindEventOnce(this.eventName("animationend"),(function(){t.removeOverflow(),t.destroy()}),this.$element),this.trigger(d.CLOSE),this.leave("opened"),!1)}},{key:"removeOverflow",value:function(){var t=!0,e=this.constructor.getInstances(),s=e.length;if(0===s)t=!0;else{var i=0;e.forEach((function(t){t.is("hide")&&i++})),i!==s&&(t=!1)}t&&n.removeClass(this.classes.OPEN,window.document.body)}},{key:"visible",value:function(){return!!this.is("opened")}},{key:"initialize",value:function(){this.validate(),this.$content=o.query(".".concat(this.classes.CONTENT),this.$element),this.$title=o.query(".".concat(this.classes.TITLE),this.$element),this.$closeBtn=o.query(".".concat(this.classes.CLOSE),this.$element),this.$buttons=o.query(".".concat(this.classes.BUTTONS),this.$element),this.options.overlay&&(this.$overlay=o.query(".".concat(this.classes.OVERLAY),this.$element)),this.options.theme&&n.addClass(this.getThemeClass(),this.$container),""!==this.options.title&&this.setTitle(this.options.title),""!==this.options.content&&this.setContent(this.options.content),this.options.buttons&&this.setButtons(this.options.buttons),this.trigger(d.READY),this.enter("initialized")}},{key:"createHtml",value:function(){var e="",s="",n="",i="",a="",l="";return this.options.closeable&&(e=t.render(this.options.templates.close.call(this),{classes:this.classes})),this.options.overlay&&(n=t.render(this.options.templates.overlay.call(this),{classes:this.classes})),""!==this.options.title&&(i=t.render(this.options.templates.title.call(this),{classes:this.classes})),""!==this.options.content&&(a=t.render(this.options.templates.content.call(this),{classes:this.classes})),this.options.buttons&&(s=t.render(this.options.templates.buttons.call(this),{classes:this.classes})),this.options.icon&&(l=t.render(this.options.templates.icon.call(this),{classes:this.classes,iconClass:this.getIconClass()}),this.$icon=o.parseHTML(l)),t.render(this.options.template.call(this),{classes:this.classes,overlay:n,close:e,title:i,content:a,buttons:s})}},{key:"getIconClass",value:function(){return this.options.icons[this.options.icon]?this.options.icons[this.options.icon]:s.isString(this.options.icon)?this.options.icon:this.options.icons.success}},{key:"setTitle",value:function(t){this.$title.innerHTML="",this.options.icon&&(o.append(this.$icon,this.$title),n.addClass(this.getClass(this.classes.ICONTITLE),this.$title)),o.append(t,this.$title)}},{key:"setContent",value:function(t){s.isElement(t)?o.append(t,this.$content):this.options.html?this.$content.innerHTML=t:this.$content.textContent=t}},{key:"setButtons",value:function(t){for(var e in this.$buttons.innerHTML="",t)if(t[e].action){var s=this.createBtn(t[e]);o.append(s,this.$buttons)}}},{key:"createBtn",value:function(e){var s=e.classes,n=e.action,i="";i=["Yes","Cancel"].includes(e.label)?this.translate(e.label):e.label;var a=t.render(this.options.templates.button.call(this),{classes:this.classes,custom:s,label:i,action:n});return o.parseHTML(a)}},{key:"destroy",value:function(){this.is("initialized")&&this.leave("initialized"),this.trigger(d.DESTROY),o.remove(this.$element),p(r(l.prototype),"destroy",this).call(this)}}])&&c(f.prototype,v),y&&c(f,y),l}(l))||f)||f)||f)||f)||f)||f)||f}));
