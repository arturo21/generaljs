/*!
 * @pluginjs/modal v0.7.23 (https://pluginjs.com)
 * Copyright 2020 Creation Studio Limited
 * Released under the GPL-3.0 License.
 */
"use strict";function _interopDefault(s){return s&&"object"==typeof s&&"default"in s?s.default:s}var _dec,_dec2,_dec3,_dec4,_dec5,_dec6,_dec7,_class,templateEngine=_interopDefault(require("@pluginjs/template")),utils=require("@pluginjs/utils"),is=require("@pluginjs/is"),classes$1=require("@pluginjs/classes"),events$1=require("@pluginjs/events"),dom=require("@pluginjs/dom"),decorator=require("@pluginjs/decorator"),GlobalComponent=_interopDefault(require("@pluginjs/global-component")),namespace="modal",events={OPEN:"open",CLOSE:"close",DESTROY:"destroy",READY:"ready"},classes={NAMESPACE:"pj-".concat(namespace),ELEMENT:"{namespace}",THEME:"{namespace}--{theme}",CLOSE:"{namespace}-close",CONTENT:"{namespace}-content",TITLE:"{namespace}-title",DISABLED:"{namespace}-disabled",CONTAINER:"{namespace}-container",HEADER:"{namespace}-header",BUTTONS:"{namespace}-buttons",OVERLAY:"{namespace}-overlay",FADEIN:"{namespace}--fadeIn",OPEN:"{namespace}-open",IN:"{namespace}-in",BUTTON:"{namespace}-btn",ICON:"{namespace}-icon",ICONTITLE:"{namespace}-title-icon"},defaults={theme:null,template:()=>'<div class="{classes.NAMESPACE}">\n              {overlay}\n              <div class="{classes.CONTAINER}" role="document">\n                {close}\n                {title}\n                {content}\n                {buttons}\n              </div>\n            </div>',templates:{close:()=>'<button type="button" class="pj-icon pj-icon-close {classes.CLOSE}" aria-label="Close"></button>',title:()=>'<div class="{classes.TITLE}"></div>',icon:()=>'<i class="{classes.ICON} {iconClass}"></i>',content:()=>'<div class="{classes.CONTENT}"></div>',buttons:()=>'<div class="{classes.BUTTONS}"></div>',overlay:()=>'<div class="{classes.OVERLAY}"></div>',button:()=>'<button class="{classes.BUTTON} {custom}" data-action={action} type="button">{label}</button>'},title:"",content:"",html:!0,closeable:!0,locale:"en",localeFallbacks:!0,buttons:null,overlay:!0,overlayCloseOnClick:!0,appendTo:"body",effect:"fadeScale",defaultButtonClass:"pj-btn pj-btn-primary",icon:null,icons:{success:"pj-icon pj-icon-check-circle",info:"pj-icon pj-icon-info-circle",error:"pj-icon pj-icon-close-circle"}},translations={en:{Cancel:"Cancel",Yes:"Yes"},zh:{Cancel:"取消",Yes:"确定"}},Modal=(_dec=decorator.translateable(translations))(_class=(_dec2=decorator.themeable())(_class=(_dec3=decorator.styleable(classes))(_class=(_dec4=decorator.eventable(events))(_class=(_dec5=decorator.stateable())(_class=(_dec6=decorator.optionable(defaults,!1))(_class=(_dec7=decorator.register(namespace))(_class=class s extends GlobalComponent{constructor(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.setupOptions(s),this.setupClasses(),this.$element=dom.parseHTML(this.createHtml()),this.$container=dom.query(".".concat(this.classes.CONTAINER),this.$element),this.setupStates(),this.setupI18n(),this.initialize(),this.bind()}validate(){return this.options.buttons&&this.options.buttons.forEach(s=>{s.classes||(s.classes=this.options.defaultButtonClass),s.label||(s.label="Yes")}),!0}open(){return!this.is("opened")&&(classes$1.addClass("".concat(this.classes.OPEN),dom.query("body")),dom.append(this.$element,dom.query(this.options.appendTo)),this.options.overlay&&(classes$1.addClass("".concat(this.classes.NAMESPACE,"-fadeIn"),this.$overlay),classes$1.removeClass("".concat(this.classes.NAMESPACE,"-fadeOut"),this.$overlay)),classes$1.removeClass("".concat(this.classes.NAMESPACE,"-").concat(this.options.effect,"Out"),this.$container),classes$1.addClass("".concat(this.classes.NAMESPACE,"-").concat(this.options.effect,"In"),this.$container),this.trigger(events.OPEN),this.enter("opened"),this.leave("hide"),!1)}bind(){this.options.closeable&&events$1.bindEvent(this.eventName("click"),()=>{this.close()},this.$closeBtn),this.options.buttons&&events$1.bindEvent(this.eventName("click"),s=>{if(!s.target.classList.contains(this.classes.BUTTON)||!dom.data("action",s.target))return!1;for(var t=dom.data("action",s.target),e=0;e<this.options.buttons.length;e++)if(t===this.options.buttons[e].action){var n=this.options.buttons[e];is.isFunction(n.fn)?n.fn(this.close.bind(this)):this.close()}return!1},this.$buttons),this.options.overlayCloseOnClick&&this.options.overlay&&events$1.bindEvent(this.eventName("click"),()=>{this.close()},this.$overlay)}close(){if(!this.is("opened"))return!1;classes$1.removeClass("".concat(this.classes.OPEN),dom.query("body")),this.options.overlay&&(classes$1.addClass("".concat(this.classes.NAMESPACE,"-fadeOut"),this.$overlay),classes$1.removeClass("".concat(this.classes.NAMESPACE,"-fadeIn"),this.$overlay)),classes$1.addClass("".concat(this.classes.NAMESPACE,"-").concat(this.options.effect,"Out"),this.$container),classes$1.removeClass("".concat(this.classes.NAMESPACE,"-").concat(this.options.effect,"In"),this.$container);return events$1.bindEventOnce(this.eventName("animationend"),()=>{this.removeOverflow(),this.destroy()},this.$element),this.trigger(events.CLOSE),this.leave("opened"),!1}removeOverflow(){var s=!0,t=this.constructor.getInstances(),e=t.length;if(0===e)s=!0;else{var n=0;t.forEach(s=>{s.is("hide")&&n++}),n!==e&&(s=!1)}s&&classes$1.removeClass(this.classes.OPEN,window.document.body)}visible(){return!!this.is("opened")}initialize(){this.validate(),this.$content=dom.query(".".concat(this.classes.CONTENT),this.$element),this.$title=dom.query(".".concat(this.classes.TITLE),this.$element),this.$closeBtn=dom.query(".".concat(this.classes.CLOSE),this.$element),this.$buttons=dom.query(".".concat(this.classes.BUTTONS),this.$element),this.options.overlay&&(this.$overlay=dom.query(".".concat(this.classes.OVERLAY),this.$element)),this.options.theme&&classes$1.addClass(this.getThemeClass(),this.$container),""!==this.options.title&&this.setTitle(this.options.title),""!==this.options.content&&this.setContent(this.options.content),this.options.buttons&&this.setButtons(this.options.buttons),this.trigger(events.READY),this.enter("initialized")}createHtml(){var s="",t="",e="",n="",i="",a="";return this.options.closeable&&(s=templateEngine.render(this.options.templates.close.call(this),{classes:this.classes})),this.options.overlay&&(e=templateEngine.render(this.options.templates.overlay.call(this),{classes:this.classes})),""!==this.options.title&&(n=templateEngine.render(this.options.templates.title.call(this),{classes:this.classes})),""!==this.options.content&&(i=templateEngine.render(this.options.templates.content.call(this),{classes:this.classes})),this.options.buttons&&(t=templateEngine.render(this.options.templates.buttons.call(this),{classes:this.classes})),this.options.icon&&(a=templateEngine.render(this.options.templates.icon.call(this),{classes:this.classes,iconClass:this.getIconClass()}),this.$icon=dom.parseHTML(a)),templateEngine.render(this.options.template.call(this),{classes:this.classes,overlay:e,close:s,title:n,content:i,buttons:t})}getIconClass(){return this.options.icons[this.options.icon]?this.options.icons[this.options.icon]:is.isString(this.options.icon)?this.options.icon:this.options.icons.success}setTitle(s){this.$title.innerHTML="",this.options.icon&&(dom.append(this.$icon,this.$title),classes$1.addClass(this.getClass(this.classes.ICONTITLE),this.$title)),dom.append(s,this.$title)}setContent(s){is.isElement(s)?dom.append(s,this.$content):this.options.html?this.$content.innerHTML=s:this.$content.textContent=s}setButtons(s){for(var t in this.$buttons.innerHTML="",s)if(s[t].action){var e=this.createBtn(s[t]);dom.append(e,this.$buttons)}}createBtn(s){var t=s.classes,e=s.action,n="";n=["Yes","Cancel"].includes(s.label)?this.translate(s.label):s.label;var i=templateEngine.render(this.options.templates.button.call(this),{classes:this.classes,custom:t,label:n,action:e});return dom.parseHTML(i)}destroy(){this.is("initialized")&&this.leave("initialized"),this.trigger(events.DESTROY),dom.remove(this.$element),super.destroy()}static open(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new s(t);return e.open(),e}static init(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=utils.deepMerge(t),n=new s(e);return n.enter("hide"),n}static close(s){this.getInstances().forEach(t=>{t.instanceId===s&&t.close()})}static confirm(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(!is.isString(e[0]))return!1;var i=utils.deepMerge(defaults,{title:"",content:"",closeable:!0,buttons:[{action:"cancel",label:"Cancel",classes:"pj-btn pj-btn-outline",fn:""},{action:"yes",label:"Yes",classes:"pj-btn pj-btn-primary",fn:""}]}),a=[],o=[],l=e.length;l&&is.isObject(e[l-1])&&(e[l-1].buttons&&(e[l-1].buttons.forEach(s=>{i.buttons.forEach(t=>{s.action===t.action&&(t.label=s.label,t.classes=s.classes)})}),delete e[l-1].buttons),i=utils.deepMerge(i,e[l-1]),l-=1);for(var c=0;c<l;c++)"string"==typeof e[c]?a.push(e[c]):is.isFunction(e[c])&&o.push(e[c]);1===a.length?i.content=a[0]:a.length>1&&(i.title=a[0],i.content=a[1]),1===o.length?i.buttons.forEach(s=>{"yes"===s.action&&(s.fn=o[0])}):o.length>1&&i.buttons.forEach(s=>{"yes"===s.action&&(s.fn=o[0]),"cancel"===s.action&&(s.fn=o[1])});var r=new s(i);return r.open(),r}static alert(){if(!is.isString(arguments.length<=0?void 0:arguments[0]))return!1;var t=utils.deepMerge(defaults,{title:"",content:"",closeable:!0}),e=arguments.length;e&&is.isObject(e-1<0||arguments.length<=e-1?void 0:arguments[e-1])&&(t=utils.deepMerge(t,e-1<0||arguments.length<=e-1?void 0:arguments[e-1]),e-=1),1===e?t.content=arguments.length<=0?void 0:arguments[0]:2===e&&(t.title=arguments.length<=0?void 0:arguments[0],t.content=arguments.length<=1?void 0:arguments[1]);var n=new s(t);return n.open(),n}static closeTop(){var s=this.getInstances(),t=s.length;return!!t&&(s[t-1].close(),!0)}static closeAll(){return this.getInstances().forEach(s=>{s.close()}),!0}static getAll(){return this.getInstances()}static getById(s){var t=this.getInstances(),e=null;return t.forEach(t=>{t.instanceId===s&&(e=t)}),e}})||_class)||_class)||_class)||_class)||_class)||_class)||_class;module.exports=Modal;
